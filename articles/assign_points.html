<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Assigning points to polygons • gslSpatial</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Assigning points to polygons">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gslSpatial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/assign_points.html">Assigning points to polygons</a></li>
    <li><a class="dropdown-item" href="../articles/working_with_rasters.html">Working with raster objects</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JoleneSutton/gslSpatial/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Assigning points to polygons</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JoleneSutton/gslSpatial/blob/main/vignettes/assign_points.Rmd" class="external-link"><code>vignettes/assign_points.Rmd</code></a></small>
      <div class="d-none name"><code>assign_points.Rmd</code></div>
    </div>

    
    
<p>There are three functions that can assign points (coordinates) to
polygons:</p>
<ul>
<li>
<strong>assign_points_terra</strong> is useful when each point could
overlap with only polygon in a shapefile</li>
<li>
<strong>assign_points_secr</strong> is useful when each point could
overlap with one or more polygons in a shapefile. It returns a presence
absence data frame to indicate whether a point is inside a polygon. The
last column in the data frame indicates all the polygons associated with
each point.</li>
<li>
<strong>assign_points_to_nearest_polygon</strong> is useful when
there are points that don’t overlap with any polygons, but you want to
know which polygon a point is nearest to. This function uses the edges,
rather than the centroids, of polygons.</li>
</ul>
<p>The examples below assign fishing coordinates to DFO September
research vessel survey strata and/or Marine Protected Areas.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JoleneSutton/gslSpatial" class="external-link">gslSpatial</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dieghernan.github.io/tidyterra/" class="external-link">tidyterra</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="get-a-shapefile">Get a shapefile<a class="anchor" aria-label="anchor" href="#get-a-shapefile"></a>
</h2>
<p>Notice that the coordinate reference system (crs) is lon/lat NAD83
(EPSG:4269). When working with spatial data, your data should all have
the same crs. If they don’t, you can re-project them (e.g.,
?terra::project).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rv</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/get_shapefile.html">get_shapefile</a></span><span class="op">(</span><span class="st">'rv.sgsl'</span><span class="op">)</span></span>
<span><span class="co">#&gt; sGSL September RV Survey</span></span>
<span></span>
<span><span class="co"># see information about the object</span></span>
<span><span class="va">rv</span> </span>
<span><span class="co">#&gt;  class       : SpatVector </span></span>
<span><span class="co">#&gt;  geometry    : polygons </span></span>
<span><span class="co">#&gt;  dimensions  : 27, 3  (geometries, attributes)</span></span>
<span><span class="co">#&gt;  extent      : -65.9368, -60.0779, 45.6756, 49.1769  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt;  coord. ref. : lon/lat NAD83 (EPSG:4269) </span></span>
<span><span class="co">#&gt;  names       :    id  area trawlable.</span></span>
<span><span class="co">#&gt;  type        : &lt;int&gt; &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;  values      :   401  1182  2.916e+04</span></span>
<span><span class="co">#&gt;                  402  1553  3.832e+04</span></span>
<span><span class="co">#&gt;                  403   388       9580</span></span>
<span></span>
<span><span class="co"># plot it</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/ggspatvector.html" class="external-link">geom_spatvector</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">rv</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="assign_points_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="get-some-data">Get some data<a class="anchor" aria-label="anchor" href="#get-some-data"></a>
</h2>
<p>This example uses commercial landings data that have longitude and
latitude coordinates with the same crs as the shapefile.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">&lt;-</span><span class="va">dat.ziff</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'longitude'</span>,<span class="st">'latitude'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;         longitude latitude</span></span>
<span><span class="co">#&gt; 6546100  -60.4406  47.2421</span></span>
<span><span class="co">#&gt; 6547100  -60.4581  47.2281</span></span>
<span><span class="co">#&gt; 6548100  -60.4581  47.2281</span></span>
<span><span class="co">#&gt; 6549100  -60.3503  47.3175</span></span>
<span><span class="co">#&gt; 6550100  -60.3503  47.3175</span></span>
<span><span class="co">#&gt; 6551100  -60.3258  47.2961</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-everything">Plot everything<a class="anchor" aria-label="anchor" href="#plot-everything"></a>
</h2>
<p>There are many points inside the polygons as well as outside the
polygons</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/ggspatvector.html" class="external-link">geom_spatvector</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">rv</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">longitude</span>,<span class="va">latitude</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="assign_points_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="using-function-assign_points_terra">Using function <code>assign_points_terra</code><a class="anchor" aria-label="anchor" href="#using-function-assign_points_terra"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/assign_points_terra.html">assign_points_terra</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">longitude</span>, <span class="va">df</span><span class="op">$</span><span class="va">latitude</span>,<span class="va">rv</span><span class="op">)</span></span>
<span><span class="co">#&gt; Processing points 1 to 1000. 12:39:46</span></span>
<span><span class="co">#&gt; Processing points 1001 to 2000. 12:39:46</span></span>
<span><span class="co">#&gt; Processing points 2001 to 3000. 12:39:46</span></span>
<span><span class="co">#&gt; Processing points 3001 to 4000. 12:39:46</span></span>
<span><span class="co">#&gt; Processing points 4001 to 4559. 12:39:46</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt;          x       y assigned.polygon</span></span>
<span><span class="co">#&gt; 1 -60.4406 47.2421              437</span></span>
<span><span class="co">#&gt; 2 -60.4581 47.2281              437</span></span>
<span><span class="co">#&gt; 3 -60.4581 47.2281              437</span></span>
<span><span class="co">#&gt; 4 -60.3503 47.3175              438</span></span>
<span><span class="co">#&gt; 5 -60.3503 47.3175              438</span></span>
<span><span class="co">#&gt; 6 -60.3258 47.2961              439</span></span>
<span></span>
<span><span class="va">stratum</span><span class="op">&lt;-</span><span class="va">x</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># combine</span></span>
<span><span class="va">df1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df</span>,<span class="va">stratum</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span></span>
<span><span class="co">#&gt;         longitude latitude stratum</span></span>
<span><span class="co">#&gt; 6546100  -60.4406  47.2421     437</span></span>
<span><span class="co">#&gt; 6547100  -60.4581  47.2281     437</span></span>
<span><span class="co">#&gt; 6548100  -60.4581  47.2281     437</span></span>
<span><span class="co">#&gt; 6549100  -60.3503  47.3175     438</span></span>
<span><span class="co">#&gt; 6550100  -60.3503  47.3175     438</span></span>
<span><span class="co">#&gt; 6551100  -60.3258  47.2961     439</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/ggspatvector.html" class="external-link">geom_spatvector</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">rv</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df1</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">longitude</span>,<span class="va">latitude</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stratum</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="assign_points_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="what-if-there-are-overlapping-polyons-use-function-assign_points_secr">What if there are overlapping polyons? Use function
<code>assign_points_secr</code><a class="anchor" aria-label="anchor" href="#what-if-there-are-overlapping-polyons-use-function-assign_points_secr"></a>
</h2>
<p>If there are overlapping polygons causing your data points to
‘belong’ to multiple polygons, you can use function
<code>assign_points_secr</code></p>
<p>Start by getting another shapefile. This example uses Oceans Act
Marine Protected Areas</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpa</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/get_shapefile.html">get_shapefile</a></span><span class="op">(</span><span class="st">'mpa'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Oceans Act Marine Protected Areas, source:https://open.canada.ca</span></span>
<span></span>
<span><span class="va">mpa</span></span>
<span><span class="co">#&gt;  class       : SpatVector </span></span>
<span><span class="co">#&gt;  geometry    : polygons </span></span>
<span><span class="co">#&gt;  dimensions  : 11, 12  (geometries, attributes)</span></span>
<span><span class="co">#&gt;  extent      : -64.14, -58.3667, 45.7833, 48.75004  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt;  coord. ref. : lon/lat NAD83 (EPSG:4269) </span></span>
<span><span class="co">#&gt;  names       : OBJECTID          NAME_E          NAME_F ZONE_E ZONE_F</span></span>
<span><span class="co">#&gt;  type        :    &lt;int&gt;           &lt;chr&gt;           &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  values      :        1 Basin Head Mar~ Zone de protec~ Zone 3 Zone 3</span></span>
<span><span class="co">#&gt;                       2 Basin Head Mar~ Zone de protec~ Zone 1 Zone 1</span></span>
<span><span class="co">#&gt;                       3 Basin Head Mar~ Zone de protec~ Zone 2 Zone 2</span></span>
<span><span class="co">#&gt;            URL_E           URL_F      REGULATION       REGLEMENT   KM2</span></span>
<span><span class="co">#&gt;            &lt;chr&gt;           &lt;chr&gt;           &lt;chr&gt;           &lt;chr&gt; &lt;num&gt;</span></span>
<span><span class="co">#&gt;  http://www.dfo~ http://www.dfo~ http://laws.ju~ http://laws.ju~  8.64</span></span>
<span><span class="co">#&gt;  http://www.dfo~ http://www.dfo~ http://laws.ju~ http://laws.ju~  0.24</span></span>
<span><span class="co">#&gt;  http://www.dfo~ http://www.dfo~ http://laws.ju~ http://laws.ju~  0.35</span></span>
<span><span class="co">#&gt;  Shape_Leng Shape_Area</span></span>
<span><span class="co">#&gt;       &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1.519e+04  8.642e+06</span></span>
<span><span class="co">#&gt;        6510  2.416e+05</span></span>
<span><span class="co">#&gt;        5976  3.541e+05</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/ggspatvector.html" class="external-link">geom_spatvector</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">mpa</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">NAME_E</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'blue'</span>,lwd<span class="op">=</span><span class="fl">1.25</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/ggspatvector.html" class="external-link">geom_spatvector</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">rv</span>,fill<span class="op">=</span><span class="cn">NA</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dat.ziff</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">longitude</span>,<span class="va">latitude</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span>,legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="fl">1</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="assign_points_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>In order to demonstrate function <code>assign_points_secr</code>, we
will combine the two shapefiles as if they were originally a single
shapefile.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://rspatial.org/" class="external-link">'terra'</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># first need to make names match</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">rv</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "id"         "area"       "trawlable."</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mpa</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "OBJECTID"   "NAME_E"     "NAME_F"     "ZONE_E"     "ZONE_F"    </span></span>
<span><span class="co">#&gt;  [6] "URL_E"      "URL_F"      "REGULATION" "REGLEMENT"  "KM2"       </span></span>
<span><span class="co">#&gt; [11] "Shape_Leng" "Shape_Area"</span></span>
<span></span>
<span><span class="va">rv</span><span class="op">$</span><span class="va">NAME</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">rv</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="va">mpa</span><span class="op">$</span><span class="va">NAME</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">mpa</span><span class="op">$</span><span class="va">NAME_E</span><span class="op">)</span></span>
<span></span>
<span><span class="va">shape</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">rv</span>,<span class="va">mpa</span><span class="op">)</span></span>
<span><span class="va">shape</span><span class="op">&lt;-</span><span class="va">shape</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NAME"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">shape</span></span>
<span><span class="co">#&gt;  class       : SpatVector </span></span>
<span><span class="co">#&gt;  geometry    : polygons </span></span>
<span><span class="co">#&gt;  dimensions  : 38, 1  (geometries, attributes)</span></span>
<span><span class="co">#&gt;  extent      : -65.9368, -58.3667, 45.6756, 49.1769  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt;  coord. ref. : lon/lat NAD83 (EPSG:4269) </span></span>
<span><span class="co">#&gt;  names       :  NAME</span></span>
<span><span class="co">#&gt;  type        : &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  values      :   401</span></span>
<span><span class="co">#&gt;                  402</span></span>
<span><span class="co">#&gt;                  403</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/ggspatvector.html" class="external-link">geom_spatvector</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">shape</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span>,legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="assign_points_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Now use function <code>assign_points_secr</code></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/assign_points_secr.html">assign_points_secr</a></span><span class="op">(</span><span class="va">dat.ziff</span><span class="op">[</span>,<span class="st">'longitude'</span><span class="op">]</span>,</span>
<span>                        <span class="va">dat.ziff</span><span class="op">[</span>,<span class="st">'latitude'</span><span class="op">]</span>,</span>
<span>                        <span class="va">shape</span>,<span class="st">"NAME"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Processing points 1 to 1000. 12:39:48</span></span>
<span><span class="co">#&gt; Processing points 1001 to 2000. 12:39:49</span></span>
<span><span class="co">#&gt; Processing points 2001 to 3000. 12:39:50</span></span>
<span><span class="co">#&gt; Processing points 3001 to 4000. 12:39:50</span></span>
<span><span class="co">#&gt; Processing points 4001 to 4559. 12:39:50</span></span>
<span></span>
<span><span class="va">polygon</span><span class="op">&lt;-</span><span class="va">x</span><span class="op">$</span><span class="va">assigned.polygon</span></span>
<span></span>
<span><span class="va">df2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dat.ziff</span>,<span class="va">polygon</span><span class="op">)</span></span></code></pre></div>
<p>Using function <code>table</code> shows that 69 points fall within
the area in which stratum 416 overlaps with Banc-des-Américains Marine
Protected Area. All other assigned points belong to non-overlapping
polygon areas.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">polygon</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      415 416 416, Banc-des-Américains Marine Protected Area 417 418 419 420 422</span></span>
<span><span class="co">#&gt; [1,] 105 111                                             69  92  77  28  31  15</span></span>
<span><span class="co">#&gt;      423 424 425 426 427 428 429 431 433 434 435 436 437 438 439</span></span>
<span><span class="co">#&gt; [1,] 264  64 198   7  43   3  33  37   4   6 236  61 302  49 177</span></span>
<span><span class="co">#&gt;      Banc-des-Américains Marine Protected Area</span></span>
<span><span class="co">#&gt; [1,]                                        15</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/ggspatvector.html" class="external-link">geom_spatvector</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">shape</span>,fill<span class="op">=</span><span class="cn">NA</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df2</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">longitude</span>,<span class="va">latitude</span>,col<span class="op">=</span><span class="va">polygon</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span>,legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>col<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="assign_points_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="assigning-points-to-the-nearest-polygon">Assigning points to the nearest polygon<a class="anchor" aria-label="anchor" href="#assigning-points-to-the-nearest-polygon"></a>
</h2>
<p>Finally, the previous examples show that a number of data points
don’t overlap with any of the polygons in our shapefiles. But what if we
wanted to find out which polygons they were closest to? Then we could
use function <code>assign_points_to_nearest_polygon</code>. This
function takes a bit longer to run compared to
<code>assign_points_terra</code> or <code>assign_points_secr</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the unassigned data points</span></span>
<span><span class="va">pts.outside</span><span class="op">&lt;-</span><span class="va">df2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">polygon</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/assign_points_to_nearest_polygon.html">assign_points_to_nearest_polygon</a></span><span class="op">(</span><span class="va">pts.outside</span><span class="op">$</span><span class="va">longitude</span>, <span class="va">pts.outside</span><span class="op">$</span><span class="va">latitude</span>, <span class="va">shape</span>, <span class="st">'NAME'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt;          x       y NAME n$distance</span></span>
<span><span class="co">#&gt; 1 -60.2833 47.4666  439  1649.2764</span></span>
<span><span class="co">#&gt; 2 -60.3000 47.4666  439   944.1621</span></span>
<span><span class="co">#&gt; 3 -60.3000 47.4666  439   944.1621</span></span>
<span><span class="co">#&gt; 4 -60.2833 47.4833  439  3034.2767</span></span>
<span><span class="co">#&gt; 5 -60.3166 47.4833  439  1080.0245</span></span>
<span><span class="co">#&gt; 6 -60.2833 47.4833  439  3034.2767</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/ggspatvector.html" class="external-link">geom_spatvector</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">shape</span>,fill<span class="op">=</span><span class="cn">NA</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">x</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,col<span class="op">=</span><span class="va">NAME</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span>,legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>col<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="assign_points_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jolene T. Sutton, Lysandre Landry.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
